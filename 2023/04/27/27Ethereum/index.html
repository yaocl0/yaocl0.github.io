<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>以太坊概述 | Mr_Yao的驿站</title><meta name="author" content="Mr_Yao"><meta name="copyright" content="Mr_Yao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="以太坊基础知识什么是以太坊以太坊（Ethereum）是一个去中心化的开源的有智能合约功能的公共区块链平台。 以太坊的概念首次在 2013 至 2014 年间由程序员维塔利克·布特林（Vitalik Buterin）受比特币启发后提出，大意为“下一代加密货币与去中心化应用平台”，在 2014 年通过 ICO 众筹得以开始发展。以太坊亦被称为“第二代的区块链平台”，仅次于比特币。目前为止，以太坊是被使">
<meta property="og:type" content="article">
<meta property="og:title" content="以太坊概述">
<meta property="og:url" content="http://yaocl.cn/2023/04/27/27Ethereum/index.html">
<meta property="og:site_name" content="Mr_Yao的驿站">
<meta property="og:description" content="以太坊基础知识什么是以太坊以太坊（Ethereum）是一个去中心化的开源的有智能合约功能的公共区块链平台。 以太坊的概念首次在 2013 至 2014 年间由程序员维塔利克·布特林（Vitalik Buterin）受比特币启发后提出，大意为“下一代加密货币与去中心化应用平台”，在 2014 年通过 ICO 众筹得以开始发展。以太坊亦被称为“第二代的区块链平台”，仅次于比特币。目前为止，以太坊是被使">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yaocl.cn/2023/04/27/27Ethereum/2.png">
<meta property="article:published_time" content="2023-04-27T05:31:22.000Z">
<meta property="article:modified_time" content="2023-08-07T01:22:28.482Z">
<meta property="article:author" content="Mr_Yao">
<meta property="article:tag" content="web3">
<meta property="article:tag" content="以太坊">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yaocl.cn/2023/04/27/27Ethereum/2.png"><link rel="shortcut icon" href="/"><link rel="canonical" href="http://yaocl.cn/2023/04/27/27Ethereum/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="MBUPLTqs-crTMrXutrEiB0jYb3zBMf1ua13kTbOEqY"/><meta name="baidu-site-verification" content="codeva-PHrgdBFiZ7"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?0202a37701ab53d1c3a4b778f332cd73";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/db.json","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '以太坊概述',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2023-08-07 09:22:28'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Mr_Yao的驿站" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = 'hidden';
    document.getElementById('loading-box').classList.remove("loaded")
  }
}

preloader.initLoading()
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.gif" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">35</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fa fa fa-comments"></i><span> 留言</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Mr_Yao的驿站"><span class="site-name">Mr_Yao的驿站</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fa fa fa-comments"></i><span> 留言</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">以太坊概述</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-04-27T05:31:22.000Z" title="发表于 2023-04-27 13:31:22">2023-04-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-08-07T01:22:28.482Z" title="更新于 2023-08-07 09:22:28">2023-08-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BB%A5%E5%A4%AA%E5%9D%8A/">以太坊</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="以太坊概述"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="以太坊基础知识"><a href="#以太坊基础知识" class="headerlink" title="以太坊基础知识"></a>以太坊基础知识</h1><h2 id="什么是以太坊"><a href="#什么是以太坊" class="headerlink" title="什么是以太坊"></a>什么是以太坊</h2><p>以太坊（Ethereum）是一个去中心化的开源的有智能合约功能的公共区块链平台。 以太坊的概念首次在 2013 至 2014 年间由程序员维塔利克·布特林（Vitalik Buterin）受比特币启发后提出，大意为“下一代加密货币与去中心化应用平台”，在 2014 年通过 ICO 众筹得以开始发展。以太坊亦被称为“第二代的区块链平台”，仅次于比特币。目前为止，以太坊是被使用最多的区块链平台。</p>
<p><img src="/2023/04/27/27Ethereum/1.png"></p>
<p>以太币（ETH 或 Ξ）是以太坊的原生加密货币，目前是市值第二高的加密货币，仅次于比特币。</p>
<h2 id="以太坊特点"><a href="#以太坊特点" class="headerlink" title="以太坊特点"></a>以太坊特点</h2><ol>
<li> 以太坊是 “世界计算机”，这代表它是一个开源的、全球分布的计算基础设施。</li>
<li> 执行称为智能合约（smart contract）的程序。</li>
<li> 使用区块链来同步和存储系统状态以及使用名为以太币（ether）的加密货币，以计量和约束执行资源成本。</li>
<li> 本质是一个基于交易的状态机 (transaction-based state machine)。</li>
<li> 以太坊平台使开发人员能够构建具有内置经济功能的强大去中心化应用程序（DApp）；在持续自我正常运行的同时，它还减少或消除了审查，第三方界面和交易对手风险。</li>
</ol>
<h2 id="以太坊的组成部分"><a href="#以太坊的组成部分" class="headerlink" title="以太坊的组成部分"></a>以太坊的组成部分</h2><p><img src="/2023/04/27/27Ethereum/2.png"></p>
<h3 id="P2P-网络"><a href="#P2P-网络" class="headerlink" title="P2P 网络"></a>P2P 网络</h3><p>以太坊在以太坊主网络上运行，该网络可在 TCP 端口 30303 上寻址，并运行一个名为 ÐΞVp2p 的协议。</p>
<h3 id="交易（Transaction）"><a href="#交易（Transaction）" class="headerlink" title="交易（Transaction）"></a>交易（Transaction）</h3><p>以太坊交易是网络消息，其中包括发送者（sender），接收者（receiver），值（value） 和数据的有效载荷（payload）。</p>
<h3 id="以太坊虚拟机（EVM）"><a href="#以太坊虚拟机（EVM）" class="headerlink" title="以太坊虚拟机（EVM）"></a>以太坊虚拟机（EVM）</h3><p>以太坊状态转换由以太坊虚拟机（EVM）处理，这是一个执行字节码（机器语言指令）的 基于堆栈的虚拟机。</p>
<h3 id="数据库（Blockchain）"><a href="#数据库（Blockchain）" class="headerlink" title="数据库（Blockchain）"></a>数据库（Blockchain）</h3><p>以太坊的区块链作为数据库（通常是 Google 的 LevelDB）本地存储在每个节点上，包含 序列化后的交易和系统状态。</p>
<h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p>以太坊有几种可互操作的客户端软件实现，其中最突出的是 Go-Ethereum（Geth）和 Parity。</p>
<h2 id="以太坊中的重要概念"><a href="#以太坊中的重要概念" class="headerlink" title="以太坊中的重要概念"></a>以太坊中的重要概念</h2><h3 id="账户（Account）"><a href="#账户（Account）" class="headerlink" title="账户（Account）"></a>账户（Account）</h3><p>账户包含地址，余额和随机数，以及可选的存储和代码的对象。</p>
<ul>
<li>  普通账户（EOA），存储和代码均为空。</li>
<li>  合约账户（Contract），包含存储和代码。</li>
</ul>
<h3 id="地址（Address）"><a href="#地址（Address）" class="headerlink" title="地址（Address）"></a>地址（Address）</h3><p>一般来说，代表一个 EOA 或合约，它可以在区块链上接收或发送交易， 更具体地说，它是 ECDSA 公钥的 keccak 散列的最右边的 160 位</p>
<h3 id="交易（Transaction）-1"><a href="#交易（Transaction）-1" class="headerlink" title="交易（Transaction）"></a>交易（Transaction）</h3><ul>
<li>  可以发送以太币和信息。</li>
<li>  向合约发送的交易可以调用合约代码，并以信息数据为函数参数。</li>
<li>  向空用户发送信息，可以自动生成以信息为代码块的合约账户。</li>
</ul>
<h3 id="gas"><a href="#gas" class="headerlink" title="gas"></a>gas</h3><p>以太坊用于执行智能合约的虚拟燃料， 以太坊虚拟机使用核算机制来衡量 gas 的消耗量并限制计算资源的消耗</p>
<h2 id="以太坊的货币"><a href="#以太坊的货币" class="headerlink" title="以太坊的货币"></a>以太坊的货币</h2><p>以太坊的货币单位称为以太（ether），也可以表示为 ETH 或符号 Ξ</p>
<ul>
<li><p>以太币的发行规则：</p>
<p>  1 、挖矿前（Pre-mine，Genesis）</p>
<p>  2014 年 7 月 / 8 月间，为众筹大约发行了 7200 万以太币。这些币有的时候被称之为 “矿前”。众筹阶段之后，以太币每年的产量基本稳定，被限制不超过 7200 万的 25%。</p>
<p>  2、挖矿产出（Mining）</p>
<ul>
<li>  区块奖励（block reward）</li>
<li>  叔块奖励（uncle reward）</li>
<li>  叔块引用奖励（uncle referencing reward）</li>
</ul>
</li>
<li><p>以太币产量未来的变化</p>
<p>  以太坊出块机制从工作量证明（PoW）转换为股权证明（PoS）后，以太币的发行会有什么变化尚未有定论。股权证明机制将使用一个称为 Casper 的协议。在 Casper 协议下，以太币的发行率将大大低于工作量证明下幽灵（GHOST）协议下的发行率。</p>
</li>
</ul>
<h2 id="以太坊的挖矿产出"><a href="#以太坊的挖矿产出" class="headerlink" title="以太坊的挖矿产出"></a>以太坊的挖矿产出</h2><h3 id="区块奖励（Block-rewards）"><a href="#区块奖励（Block-rewards）" class="headerlink" title="区块奖励（Block rewards）"></a>区块奖励（Block rewards）</h3><p>每产生一个新区块就会有一笔固定的奖励给矿工，初始是 5 个以太币，现在是 3 个。</p>
<h3 id="叔块奖励（Uncle-rewards）"><a href="#叔块奖励（Uncle-rewards）" class="headerlink" title="叔块奖励（Uncle rewards）"></a>叔块奖励（Uncle rewards）</h3><p>有些区块被挖得稍晚一些，因此不能作为主区块链的组成部分。比特币称这类区块为 “孤块”，并且完全舍弃它们。但是，以太币称它们为 “叔块”（uncles），并且在之后的区块中，可以引用它们。如果叔块在之后的区块链中作为叔块被引用，每个叔块会为挖矿者产出区块奖励的 7/8。这被称之为叔块奖励。</p>
<h3 id="叔块引用奖励（Uncle-referencing-rewards）"><a href="#叔块引用奖励（Uncle-referencing-rewards）" class="headerlink" title="叔块引用奖励（Uncle referencing rewards）"></a>叔块引用奖励（Uncle referencing rewards）</h3><p>矿工每引用一个叔块，可以得到区块奖励的 1/32 作为奖励（最多引用两个叔块）。</p>
<h2 id="以太坊区块收入"><a href="#以太坊区块收入" class="headerlink" title="以太坊区块收入"></a>以太坊区块收入</h2><h3 id="普通区块收入"><a href="#普通区块收入" class="headerlink" title="普通区块收入"></a>普通区块收入</h3><ul>
<li>  固定奖励（挖矿奖励），每个普通区块都有。</li>
<li>  区块内包含的所有程序的 gas 花费的总和。</li>
<li>  如果普通区块引用了叔块，每引用一个叔块可以得到固定奖励的 1/32</li>
</ul>
<h3 id="叔块收入"><a href="#叔块收入" class="headerlink" title="叔块收入"></a>叔块收入</h3><p>叔块收入只有一项，就是叔块奖励，计算公式为： 叔块奖励 = (叔块高度 + 8 – 引用叔块的区块高度) * 普通区块奖励 / 8。</p>
<h2 id="以太坊和图灵完备"><a href="#以太坊和图灵完备" class="headerlink" title="以太坊和图灵完备"></a>以太坊和图灵完备</h2><p>1936 年，英国数学家艾伦 · 图灵（Alan Turing）创建了一个计算机的数学模型，它由一个控制器、一个读写头和一根无限长的工作带组成。纸带起着存储的作用，被分成一个个的小方格（可以看成磁带）；读写头能够读取纸带上的信息，以及将运算结果写进纸带；控制器则负责根据程序对搜集到的信息进行处理。在每个时刻，机器头都要从当前纸带上读入一个方格信息，然后结合自己的内部状态查找程序表，根据程序输出信息到纸带方格上，并转换自己的内部状态，然后进行移动纸带。这样的机器称为图灵机。</p>
<p><img src="/2023/04/27/27Ethereum/3.png"><br>如果一个系统可以模拟任何图灵机，它就被定义为 “图灵完备”（Turing Complete）的。 这种系统称为通用图灵机（UTM）</p>
<p>以太坊能够在称为以太坊虚拟机的状态机中执行存储程序，同时向内存读取和写入数据， 使其成为图灵完备系统，因此成为通用图灵机。考虑到有限存储器的限制，以太坊可以计 算任何可由任何图灵机计算的算法。简单来说，以太坊中支持循环语句，理论上可以运行 “无限循环” 的程序</p>
<h2 id="去中心化应用"><a href="#去中心化应用" class="headerlink" title="去中心化应用"></a>去中心化应用</h2><ul>
<li>  基于以太坊可以创建智能合约 (Smart Contract) 来构建去中心化应用 (Decentralized Application，简称为 DApp）</li>
<li>  以太坊的构想是成为 DApps 编程开发的平台</li>
<li>DApp 至少由以下组成：<ul>
<li>  区块链上的智能合约</li>
<li>  Web 前端用户界面</li>
</ul>
</li>
</ul>
<h2 id="以太坊应用"><a href="#以太坊应用" class="headerlink" title="以太坊应用"></a>以太坊应用</h2><ul>
<li>  基于以太坊创建新的加密货币（CryptoCurrency，这种能力是 2017 年各种 ICO 泛滥的技术动因）。</li>
<li>  基于以太坊创建域名注册系统、博彩系统。</li>
<li>  基于以太坊开发去中心化的游戏，比如 2017 年底红极一时的以太猫（CryptoKitties，最高单只猫售价高达 80W 美元)。</li>
</ul>
<h2 id="代币（Token）"><a href="#代币（Token）" class="headerlink" title="代币（Token）"></a>代币（Token）</h2><ul>
<li>  代币（token）也称作通证，本意为 “令牌”，代表有所有权的资产、货币、权限等在区块链上的抽象。</li>
<li>  可替代性通证（fungible token）：指的是基于区块链技术发行的，互相可以替代的，可以接近无限拆分的 token。</li>
<li>  非同质通证（non-fungible token）： 指的是基于区块链技术发行的，唯一的，不可替代的，大多数情况下不可拆分的 token，如加密猫（CryptoKitties）。</li>
</ul>
<h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><ul>
<li>  IP： Ethereum Improvement Proposals，以太坊改进建议。</li>
<li>  ERC：Ethereum Request for Comments 的缩写，以太坊征求意见。一些 EIP 被标记为 ERC，表示试图定义以太坊使用的特定标准的提议。</li>
<li>  EOA：External Owned Account，外部账户。由以太坊网络的人类用户创建的账户。</li>
<li>  Ethash：以太坊 1.0 的工作量证明算法。</li>
<li>  HD 钱包：使用分层确定性（HD protocol）密钥创建和转账协议（BIP32）的钱包。</li>
<li>  Keccak256：以太坊中使用的密码哈希函数。Keccak256 被标准化为 SHA-3。</li>
<li>  Nonce：在密码学中，术语 nonce 用于指代只能使用一次的值。以太坊使用两种类型的随机数，账户随机数和 POW 随机数。</li>
</ul>
<h1 id="以太坊客户端"><a href="#以太坊客户端" class="headerlink" title="以太坊客户端"></a>以太坊客户端</h1><h2 id="什么是以太坊客户端"><a href="#什么是以太坊客户端" class="headerlink" title="什么是以太坊客户端"></a>什么是以太坊客户端</h2><p>以太坊客户端是一个软件应用程序，它实现以太坊规范并通过 p2p 网络与其他以太坊客户端进行通信。如果不同的以太坊客户端符合参考规范和标准化通信协议，则可以进行相互操作。</p>
<p>以太坊是一个开源项目，由 “<a target="_blank" rel="noopener" href="https://ethereum.github.io/yellowpaper/paper.pdf" title="以太坊黄皮书">以太坊黄皮书</a>” 正式规范定义。除了各种以太坊改进提案之外，此正式规范还定义了以太坊客户端的标准行为，因为有了明确的正式规范，以太网客户端有了许多独立开发的软件实现，它们之间又可以彼此交互。</p>
<p><img src="/2023/04/27/27Ethereum/4.png"></p>
<h2 id="基于以太坊规范的网络"><a href="#基于以太坊规范的网络" class="headerlink" title="基于以太坊规范的网络"></a>基于以太坊规范的网络</h2><p>存在各种基于以太坊规范的网络，这些网络基本符合 “以太坊黄皮书” 中定义的形式规范，但它们之间可能相互也可能不相互操作。</p>
<p>这些基于以太坊的网络中有：以太坊，以太坊经典，Ella，Expanse，Ubiq，Musicoin 等等。</p>
<p>虽然大多数在协议级别兼容，但这些网络通常具有特殊要求，以太坊客户端软件的维护人员、需要进行微小更改、以支持每个网络的功能或属性。</p>
<h2 id="以太坊的多种客户端"><a href="#以太坊的多种客户端" class="headerlink" title="以太坊的多种客户端"></a>以太坊的多种客户端</h2><ul>
<li>go-ethereum (Go)：<br>官方推荐，开发使用最多， Geth 是由以太坊基金会积极开发的 Go 语言实现，因此被认为是以太坊客户端的 “官方” 实现。通常，每个基于以太坊的区块链都有自己的 Geth 实现</li>
<li>parity (Rust)： 最轻便客户端，在历次以太坊网络攻击中表现卓越。</li>
<li>cpp-ethereum (C++)</li>
<li>pyethapp (python)</li>
<li>ethereumjs (javascript)</li>
<li>EthereumJ / Harmony (Java)</li>
</ul>
<h2 id="JSON-RPC"><a href="#JSON-RPC" class="headerlink" title="JSON-RPC"></a>JSON-RPC</h2><p>以太坊客户端提供了 API 和一组远程调用（RPC）命令，这些命令被编码为 JSON。这被称为 JSON-RPC API。本质上，JSON-RPC API 就是一个接口，允许编写的程序使用以太坊客户端作为网关，访问以太坊网络和链上数据。</p>
<p>通常，RPC 接口作为一个 HTTP 服务，端口设定为 8545。出于安全原因，默认情况下，它仅限于接受来自 localhost 的连接。</p>
<p>要访问 JSON-RPC API，可以使用编程语言编写的专用库，例如 JavaScript 的 web3.js，或者也可以手动构建 HTTP 请求并发送 / 接收 JSON 编码的请求。</p>
<h2 id="以太坊全节点"><a href="#以太坊全节点" class="headerlink" title="以太坊全节点"></a>以太坊全节点</h2><p>全节点是整个主链的一个副本，存储并维护链上的所有数据，可以随时验证新区块的合法性，运行全节点将耗费巨大的成本，包括硬件资源和带宽。</p>
<p>区块链的健康和扩展弹性，取决于具有许多独立操作和地理上分散的全节点。每个全节点都可以帮助其他新节点获取区块数据，并提供所有交易和合约的独立验证。</p>
<p>以太坊开发不需要在实时网络（主网）上运行的全节点。可以使用测试网络的节点来代替，也可以用本地私链，或者使用服务商提供的基于云的以太坊客户端，这些几乎都可以执行所有操作。</p>
<h2 id="远程客户端和轻节点"><a href="#远程客户端和轻节点" class="headerlink" title="远程客户端和轻节点"></a>远程客户端和轻节点</h2><p>远程客户端：<br>不存储区块链的本地副本或验证块和交易。这些客户端一般只提供钱包的功能，可以创建和广播交易。远程客户端可用于连接到现有网络，MetaMask 就是一个这样的客户端。</p>
<p>轻节点：<br>不保存链上的区块历史数据，只保存区块链当前的状态。轻节点可以对块和交易进行验证。</p>
<h3 id="全节点的优缺点"><a href="#全节点的优缺点" class="headerlink" title="全节点的优缺点"></a>全节点的优缺点</h3><ul>
<li>优点<ul>
<li>为以太坊网络的灵活性和抗审查性提供有力支持。</li>
<li>权威地验证所有交易。</li>
<li>可以直接与公共区块链上的任何合约交互。</li>
<li>可以离线查询区块链状态（帐户，合约等）。</li>
<li>可以直接把自己的合约部署到公共区块链中。</li>
</ul>
</li>
<li>缺点<ul>
<li>需要巨大的硬件和带宽资源，而且会不断增长。</li>
<li>第一次下载往往需要几天才能完全同步。</li>
<li>必须及时维护、升级并保持在线状态以同步区块。。</li>
</ul>
</li>
</ul>
<h3 id="公共测试网络节点的优缺点"><a href="#公共测试网络节点的优缺点" class="headerlink" title="公共测试网络节点的优缺点"></a>公共测试网络节点的优缺点</h3><ul>
<li>优点<ul>
<li>一个 testnet 节点需要同步和存储更少的数据，大约 10GB，具体取决于不同的网络</li>
<li>一个 testnet 节点一般可以在几个小时内完全同步</li>
<li>部署合约或进行交易只需要发送测试以太，可以从 “水龙头” 免费获得</li>
<li>测试网络是公共区块链，有许多其他用户和合约运行（区别于私链）</li>
</ul>
</li>
<li>缺点<ul>
<li>测试网络上使用测试以太，它没有价值。因此，无法测试交易对手的安全性，因为没有任何利害关系</li>
<li>测试网络上的测试无法涵盖所有的真实主网特性。例如，交易费用虽然是发送交易所必需的，但由于 gas 免费，因此 testnet 上往往不会考虑。而且一般来说，测试网络不会像主网那样经常拥堵</li>
</ul>
</li>
</ul>
<h3 id="本地私链的优缺点"><a href="#本地私链的优缺点" class="headerlink" title="本地私链的优缺点"></a>本地私链的优缺点</h3><ul>
<li>优点<ul>
<li>磁盘上几乎没有数据，也不同步别的数据，是一个完全 “干净” 的环境</li>
<li>无需获取测试以太，你可以任意分配以太，也可以随时自己挖矿获得</li>
<li>没有其他用户，也没有其他合约，没有任何外部干扰</li>
</ul>
</li>
<li>缺点<ul>
<li>没有其他用户意味与公链的行为不同。发送的交易并不存在空间或交易顺序的竞争</li>
<li>除自己之外没有矿工意味着挖矿更容易预测，因此无法测试公链上发生的某些情况</li>
<li>没有其他合约，意味着你必须部署要测试的所有内容</li>
</ul>
</li>
</ul>
<h2 id="用-Geth-搭建以太坊私链"><a href="#用-Geth-搭建以太坊私链" class="headerlink" title="用 Geth 搭建以太坊私链"></a>用 Geth 搭建以太坊私链</h2><p>一种是直接用源码安装，直接克隆 git 仓库，获取源代码的副本。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ethereum/go-ethereum.git</span><br></pre></td></tr></table></figure>

<p>另一种是到官网直接下载对应系统的安装程序。</p>
<p>查看<code>geth version</code>，确保在真正运行之前安装正常。</p>
<h3 id="启动节点同步"><a href="#启动节点同步" class="headerlink" title="启动节点同步"></a>启动节点同步</h3><p>安装好了 Geth，可以尝试运行一下它。执行下面的命令，geth 就会开始同步区块，并存储在当前目录下。这里的<code>--syncmode fast</code>参数表示会以 “快速” 模式同步区块。在这种模式下，只会下载每个区块头和区块体，但不会执行验证所有的交易，直到所有区块同步完毕再去获取一个系统当前的状态。这样就节省了很多交易验证的时间。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth –datadir . --syncmode fast</span><br></pre></td></tr></table></figure>

<p>如果想同步测试网络的区块，可以用下面的命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --testnet --datadir . --syncmode fast</span><br></pre></td></tr></table></figure>

<p><code>--testnet</code>这个参数会告诉 geth 启动并连接到最新的测试网络，测试网络的区块和交易数量会明显少于主网，所以会更快一点。但即使是用快速模式同步测试网络，也会需要几个小时的时间。</p>
<h3 id="搭建自己的私链"><a href="#搭建自己的私链" class="headerlink" title="搭建自己的私链"></a>搭建自己的私链</h3><p>因为公共网络的区块数量太多，同步耗时太长，为了方便快速了解 Geth，可以试着用它来搭一个只属于自己的私链。</p>
<p>首先，需要创建网络的 “创世”（genesis）状态，这写在一个小小的 JSON 文件里（例如，将其命名为 genesis.json）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;config&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;chainId&quot;</span>: <span class="number">15</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;difficulty&quot;</span>: <span class="string">&quot;2000&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;gasLimit&quot;</span>: <span class="string">&quot;2100000&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;alloc&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;7df9a875a174b3bc565e6424a0050ebc1b2d1d82&quot;</span>: &#123; <span class="attr">&quot;balance&quot;</span>: <span class="string">&quot;300000&quot;</span> &#125;,</span><br><span class="line">        <span class="attr">&quot;f41c74c9ae680c1aa78f42e5647a62f353b7bdde&quot;</span>: &#123; <span class="attr">&quot;balance&quot;</span>: <span class="string">&quot;400000&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要创建一条以它作为创世块的区块链，可以使用下面的命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --datadir path/to/custom/data/folder init genesis.json</span><br></pre></td></tr></table></figure>

<p>在当前目录下运行 geth，就会启动这条私链，注意要将 networked 设置为与创世块配置里的 chainId 一致。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --datadir path/to/custom/data/folder --networkid 15</span><br></pre></td></tr></table></figure>

<p>现在，节点正常启动，恭喜！已经成功启动了一条自己的私链。</p>
<h3 id="Geth-控制台命令"><a href="#Geth-控制台命令" class="headerlink" title="Geth 控制台命令"></a>Geth 控制台命令</h3><p>Geth Console 是一个交互式的 JavaScript 执行环境，里面内置了一些用来操作以太坊的 JavaScript 对象，可以直接调用这些对象来获取区块链上的相关信息。这些对象主要包括：</p>
<ul>
<li><p>eth：主要包含对区块链进行访问和交互相关的方法；</p>
</li>
<li><p>net：主要包含查看 p2p 网络状态的方法；</p>
</li>
<li><p>admin：主要包含与管理节点相关的方法；</p>
</li>
<li><p>miner：主要包含挖矿相关的一些方法；</p>
</li>
<li><p>personal：包含账户管理的方法；</p>
</li>
<li><p>txpool：包含查看交易内存池的方法；</p>
</li>
<li><p>web3：包含以上所有对象，还包含一些通用方法<br>常用命令有：</p>
</li>
<li><p>personal.newAccount()：创建账户；</p>
</li>
<li><p>personal.unlockAccount()：解锁账户；</p>
</li>
<li><p>eth.accounts：列出系统中的账户；</p>
</li>
<li><p>eth.getBalance()：查看账户余额，返回值的单位是 Wei；</p>
</li>
<li><p>eth.blockNumber：列出当前区块高度；</p>
</li>
<li><p>eth.getTransaction()：获取交易信息；</p>
</li>
<li><p>eth.getBlock()：获取区块信息；</p>
</li>
<li><p>miner.start()：开始挖矿；</p>
</li>
<li><p>miner.stop()：停止挖矿；</p>
</li>
<li><p>web3.fromWei()：Wei 换算成以太币；</p>
</li>
<li><p>web3.toWei()：以太币换算成 Wei；</p>
</li>
<li><p>txpool.status：交易池中的状态；</p>
</li>
</ul>
<h1 id="以太坊交易"><a href="#以太坊交易" class="headerlink" title="以太坊交易"></a>以太坊交易</h1><h2 id="以太币单位"><a href="#以太币单位" class="headerlink" title="以太币单位"></a>以太币单位</h2><p><img src="/2023/04/27/27Ethereum/5.png"></p>
<ul>
<li>  以太坊的货币单位称为以太，也称为 ETH 或符号 Ξ 。</li>
<li>  ether 被细分为更小的单位，直到可能的最小单位，称为 wei；1 ether = 10^18 wei 。</li>
<li>  以太的值总是在以太坊内部表示为以 wei 表示的无符号整数值。</li>
<li>  以太的各种单位都有一个使用国际单位制（SI）的科学名称，和一个口语名称。</li>
</ul>
<h2 id="以太坊账户"><a href="#以太坊账户" class="headerlink" title="以太坊账户"></a>以太坊账户</h2><h3 id="私钥、公钥和地址"><a href="#私钥、公钥和地址" class="headerlink" title="私钥、公钥和地址"></a>私钥、公钥和地址</h3><ul>
<li><p>  私钥（Private Key）：以太坊私钥是一个 256 位的随机数，用于发送以太的交易中创建签名来证明自己对资金的所有权</p>
</li>
<li><p>  公钥（Public Key）：公钥是由私钥通过椭圆曲线加密 secp256k1 算法单向生成的 512 位 （64 字节）数</p>
</li>
<li><p>  地址（Address）：地址是由公钥的 Keccak-256 单向哈希，取最后 20 个字节（160 位） 派生出来的标识符</p>
</li>
</ul>
<h3 id="以太坊账户类型"><a href="#以太坊账户类型" class="headerlink" title="以太坊账户类型"></a>以太坊账户类型</h3><p>以太坊账户分为外部账户 (Externally owned account, EOA)和 合约账户 (Contract accounts)。<br><img src="/2023/04/27/27Ethereum/6.png"></p>
<h4 id="EOA"><a href="#EOA" class="headerlink" title="EOA"></a>EOA</h4><p>外部账户：普通用户用私钥控制的账户</p>
<ul>
<li>  有对应的以太币余额</li>
<li>  可发送交易（转币或触发合约代码）</li>
<li>  由用户私钥控制</li>
<li>  没有关联代码</li>
</ul>
<h4 id="合约账户"><a href="#合约账户" class="headerlink" title="合约账户"></a>合约账户</h4><p>一种拥有合约代码的账户，它不属于任何人，也没有私钥与之对应。</p>
<ul>
<li>  有对应的以太币余额</li>
<li>  有关联代码</li>
<li>  由代码控制</li>
<li>  可通过交易或来自其它合约的调用消息来触发代码执行</li>
<li>  执行代码时可以操作自己的存储空间，也可以调用其它合约</li>
</ul>
<h2 id="以太坊钱包"><a href="#以太坊钱包" class="headerlink" title="以太坊钱包"></a>以太坊钱包</h2><p>以太坊钱包是我们进入以太坊系统的门户。它包含了私钥，可以代表我们创建和广播交易，常见得钱包有：</p>
<ul>
<li><p>  MetaMask：一个浏览器扩展钱包，可在浏览器中运行。下面例子中使用的是 MetaMask。</p>
</li>
<li><p>  Jaxx：一款多平台、多币种的钱包，可在各种操作系统上运行，包括 Android，iOS，Windows，Mac 和 Linux。</p>
</li>
<li><p>  MyEtherWallet（MEW）：一个基于 web 的钱包，可以在任何浏览器中运行。</p>
</li>
<li><p>  Emerald Wallet：旨在与 ETC 配合使用，但与其他基于以太坊的区块链兼容。</p>
</li>
</ul>
<h2 id="交易"><a href="#交易" class="headerlink" title="交易"></a>交易</h2><p>以太坊中的交易是一个签名的数据包，由 EOA 发送到另一个账户，由以太坊网络传输，并被序列化后记录在以太坊区块链上，并且以太坊是一个全局单例状态机，交易是唯一可以触发状态更改或导致合约在 EVM 中执行的事物。</p>
<p>数据包里包含：</p>
<ul>
<li>  nonce：由发起人 EOA 发出的序列号，用于防止交易消息重播</li>
<li>  gas price：交易发起人愿意支付的 gas 单价（wei）</li>
<li>  start gas：交易发起人愿意支付的最大 gas 量</li>
<li>  to：目的以太坊地址</li>
<li>  value：要发送到目的地的以太数量</li>
<li>  data：可变长度二进制数据负载（payload）</li>
<li>  v,r,s：发起人 EOA 的 ECDSA 签名的三个组成部分</li>
</ul>
<p>交易消息的结构使用递归长度前缀（RLP）编码方案进行序列化，该方案专为在以太坊中准确和字节完美的数据序列化而创建。</p>
<h3 id="nonce"><a href="#nonce" class="headerlink" title="nonce"></a>nonce</h3><p>对于 EOA 账户，nonce 等于从这个账户地址发送的交易数。 对于合约账户，nonce 等于这个这个账户中创建的合约数。</p>
<p>nonce 值还用于防止错误计算账户余额。nonce 强制来自任何地址的交易按顺序处理，没有间隔，无论节点接收它们的顺序如何。使用 nonce 确保所有节点计算相同的余额和正确的序列交易，等同于用于防止比特币 “双重支付”（“重放攻击”）的机制。</p>
<h3 id="gas-1"><a href="#gas-1" class="headerlink" title="gas"></a>gas</h3><p>当交易或消息触发 EVM 运行时，每个指令都会在网络的每个节点上执行。对于每个执行的操作，都存在固定的成本，这个成本用一定量的 gas 表示。发起交易时，需要从执行代码的矿工那里用以太币购买 gas。</p>
<p>gas 与消耗的系统资源对应，这是具有自然成本的。因此在设计上 gas 和 ether 有意地解耦，消耗的 gas 数量代表了对资源的占用，而对应的交易费用则还跟 gas 对以太的单价有关。这两者是由自由市场调节的：gas 的价格实际上是由矿工决定的，他们可以拒绝处理 gas 价格低于最低限额的交易。我们不需要专门购买 gas ，只需将以太币添加到帐户即可，客户端在发送交易时会自动用以太币购买 gas。而以太币本身的价格通常由于市场力量而波动。</p>
<h3 id="gas-的计算"><a href="#gas-的计算" class="headerlink" title="gas 的计算"></a>gas 的计算</h3><p>在发起交易时发起人会先设置一个<code>gas limit</code>，代表消耗 gas 得上限，相当于押金。 实际支付的 gas 数量是执行过程中消耗的 gas （gasUsed），<code>gas limit</code> 中剩余的部分会返回给发送人。最终支付的 gas 费用是 gasUsed 对应的以太币费用，单价由设定的 gasPrice 而定。</p>
<p>最终支付费用 <code>totalCost = gasPrice * gasUsed</code> totalCost 会作为交易手续费（Tx fee）支付给矿工</p>
<h3 id="交易的接收者：to"><a href="#交易的接收者：to" class="headerlink" title="交易的接收者：to"></a>交易的接收者：to</h3><p><code>to</code>字段是一个 20 字节的以太坊地址，可以是 EOA 也可以是合约地址。</p>
<p>在以太坊中，任何 20 字节的值都被认为是有效的，以太坊没有做验证。如果 20 字节值没有对应的地址或者是不存在的合约，交易也是有效的，但是以太坊会销毁发送的以太，使其永远无法访问。</p>
<h3 id="交易的-value-和-data"><a href="#交易的-value-和-data" class="headerlink" title="交易的 value 和 data"></a>交易的 value 和 data</h3><p><code>value</code> 和 <code>data</code>是交易主要的“有效负载”，它们可以有 4 中组合。</p>
<ul>
<li>  仅有 value： 表示一笔以太的付款。</li>
<li>  仅有 data： 一般表示合约调用。</li>
<li>  同时有 value 和 data： 进行合约调用，同时忘合约中发送以太。</li>
<li>  既没有 value 也没有 data： 只是在浪费 gas，但它是有效的。</li>
</ul>
<h2 id="特殊交易：创建（部署）合约"><a href="#特殊交易：创建（部署）合约" class="headerlink" title="特殊交易：创建（部署）合约"></a>特殊交易：创建（部署）合约</h2><p>有一种特殊的交易，具有数据负载且没有 value，那就是一个创建新合约的交易。这个交易的<code>to</code>地址是一个特殊的地址，即零地址： 0x0。该地址既不代表 EOA 也不代表合约。它永远不会花费以太或发起交易，它仅用作目的地，具有特殊含义 “创建合约”。</p>
<p>虽然零地址仅用于合同注册，但它有时会收到来自各种地址的付款。 这种情况要么是偶然误操作，导致失去以太；要么是故意销毁以太。</p>
<h1 id="以太坊虚拟机-EVM"><a href="#以太坊虚拟机-EVM" class="headerlink" title="以太坊虚拟机 (EVM)"></a>以太坊虚拟机 (EVM)</h1><h2 id="以太坊虚拟机-EVM-简介"><a href="#以太坊虚拟机-EVM-简介" class="headerlink" title="以太坊虚拟机 (EVM) 简介"></a>以太坊虚拟机 (EVM) 简介</h2><p>以太坊虚拟机（ EVM ）是<code>智能合约</code>的运行环境， 作为区块验证协议的一部分，参与网络的每个节点都会运行 EVM。他们会检查正在验证的块中列出的交易，并运行由 EVM 中的交易触发的代码。</p>
<p>EVM 不仅是沙盒封装的，而且是完全隔离的，也就是说在 EVM 中运行的代码是无法访问网络、文件系统和其他进程的， 甚至智能合约之间的访问也是受限的。</p>
<p>合约以字节码的格式（EVM bytecode）存在于区块链上， 合约通常以高级语言（solidity）编写，通过 EVM 编译器编译为字节码，最终通过客户端上载部署到区块链网络中。</p>
<h2 id="EVM的工作原理"><a href="#EVM的工作原理" class="headerlink" title="EVM的工作原理"></a>EVM的工作原理</h2><h3 id="代码编译和部署"><a href="#代码编译和部署" class="headerlink" title="代码编译和部署"></a>代码编译和部署</h3><p>在以太坊上开发智能合约时，开发者使用Solidity等高级编程语言编写合约代码，并通过编译器将其转换为EVM能够理解和执行的字节码。</p>
<p>编译得到的字节码会被写入以太坊区块链，并分配一个唯一的合约地址。合约地址用于唯一标识合约在区块链上的存储位置。</p>
<h3 id="交易执行"><a href="#交易执行" class="headerlink" title="交易执行"></a>交易执行</h3><p>当一个合约交易被广播到以太坊网络时，EVM的节点会接收到该交易，并进行验证。验证通过后，EVM开始执行交易中的智能合约代码。</p>
<h3 id="EVM执行环境"><a href="#EVM执行环境" class="headerlink" title="EVM执行环境"></a>EVM执行环境</h3><p>EVM提供了一个独立的执行环境，每个交易都在自己的环境中执行。EVM的执行环境由以下几个组成部分：</p>
<p><img src="/2023/04/27/27Ethereum/7.png"></p>
<ul>
<li><p>栈（Stack）</p>
<p>  EVM 使用栈来存储和处理数据。栈是一种后进先出（LIFO）结构，用于执行指令时的操作数栈和返回值栈。</p>
<p>  存放部分局部值类型变量，几乎免费使用的内存，但有数量限制。</p>
</li>
<li><p>内存（Memory）</p>
<p>  EVM 提供了一块可扩展的内存区域，用于临时存储和操作数据。智能合约可以通过读写内存来进行复杂的计算和数据处理。</p>
<p>  每一次消息调用，合约会临时获取一块干净的内存空间，生命周期仅为整个方法执行期间，函数调用后回收，因为仅保存临时变量，故读写 gas 开销较小。</p>
</li>
<li><p>存储（Storage）<br>  EVM 提供了持久化的存储空间，用于永久保存合约的状态和数据。这是一个将 256 位字映射到 256 位字的 key-value 存储区，可以理解为合约的数据库，每个合约都有自己的存储空间。</p>
<p>  由于会永久保存合约状态变量，所以读写的 gas 开销也最大。</p>
</li>
<li><p>指令集（Instruction Set）</p>
<p>  EVM 定义了一套指令集，用于执行智能合约的操作和功能。指令集包括基本的算术运算、逻辑运算、存储读写操作等，也可以做到有条件和无条件跳转。所有的指令都是针对 “256 位的字（word）“这个基本的数据类型来进行操作。</p>
</li>
</ul>
<h3 id="执行过程"><a href="#执行过程" class="headerlink" title="执行过程"></a>执行过程</h3><p>EVM的执行过程可以简单概括为以下几个步骤：</p>
<p>解析交易：EVM首先解析交易数据，提取出合约地址、调用参数等信息。</p>
<p>创建执行环境：EVM为该交易创建一个独立的执行环境，包括栈、存储和内存空间。</p>
<p>执行合约代码：EVM按照合约代码的指令顺序逐条执行，通过操作码来执行各种操作，如计算、存储、跳转等。</p>
<p>栈操作：EVM使用栈来保存和处理数据。在执行过程中，可以将数据压入栈顶、从栈顶弹出数据，进行栈上计算操作。</p>
<p>存储操作：EVM提供了持久化的存储空间Storage，可以读取和写入合约的状态和数据。通过存储操作码，可以将数据存储到存储空间或从存储空间中读取数据。</p>
<p>内存操作：EVM的临时内存空间可用于临时存储数据。通过内存操作码，可以将数据加载到内存中或从内存中读取数据。</p>
<p>跳转操作：EVM支持跳转操作，可以根据条件或无条件地改变代码执行的流程，实现条件判断、循环等控制结构。</p>
<p>异常处理：在执行过程中，如果遇到错误或异常情况，EVM会停止执行并回滚状态，确保合约的执行不会导致不一致的状态。</p>
<p>结束执行：当合约代码执行完毕或遇到返回指令时，EVM将结束执行，并将执行结果返回给调用者。</p>
<h1 id="编写智能合约"><a href="#编写智能合约" class="headerlink" title="编写智能合约"></a>编写智能合约</h1><h2 id="MetaMask-钱包"><a href="#MetaMask-钱包" class="headerlink" title="MetaMask 钱包"></a>MetaMask 钱包</h2><p>以太坊钱包是我们进入以太坊系统的门户。它包含了私钥，可以代表我们创建和广播交易。本文我们使用 MetaMask 钱包。 MetaMask 钱包可以在谷歌浏览器插件中安装。</p>
<h3 id="添加测试地址"><a href="#添加测试地址" class="headerlink" title="添加测试地址"></a>添加测试地址</h3><p>在以太坊主网上进行交易和执行智能合约需要支付 gas 费用，这些费用在开发和测试阶段可能会累积成相当大的开销。 因此，在开发和测试阶段一般都是使用太坊测试网络。这些测试网络通常提供免费的测试以太币。</p>
<p>这里有一些以太坊测试地址：<a target="_blank" rel="noopener" href="https://talk.comunion.org/d/650-comunion-rpc-erc-20">https://talk.comunion.org/d/650-comunion-rpc-erc-20</a></p>
<p>本文选择 Avalanch 测试链：</p>
<pre><code>Avalanch Avalanch - Avalanch Testent
网络名称：Avalanche Fuji Testnet
新增 RPC URL：https://api.avax-test.network/ext/bc/C/rpc
Chain ID：43113
货币符号：AVAX
区块链浏览器 URL：https://cchain.explorer.avax-test.network
水龙头地址：https://faucet.avax.network/
</code></pre>
<h3 id="领取测试币"><a href="#领取测试币" class="headerlink" title="领取测试币"></a>领取测试币</h3><p>进入测试网络的水龙头地址<code>https://faucet.avax.network/</code>中，连接 MetaMask</p>
<p><img src="/2023/04/27/27Ethereum/8.png"></p>
<p>连接到 MetaMask 后，地址栏中会显示钱包的地址，点击<code>Request 2 AVAX</code>，等待交易完成，钱包地址中会有 2 AVAX 代币。<br><img src="/2023/04/27/27Ethereum/9.png"></p>
<h3 id="MateMask-中添加测试网络。"><a href="#MateMask-中添加测试网络。" class="headerlink" title="MateMask 中添加测试网络。"></a>MateMask 中添加测试网络。</h3><p>点击下面的<code>将子网添加到钱包</code>，并将钱包切换到测试网络。<br><img src="/2023/04/27/27Ethereum/10.png"></p>
<p>完成后，可以在钱包查看测试网中的账户信息<br><img src="/2023/04/27/27Ethereum/11.png"></p>
<h2 id="在-Remix-上构建简单的水龙头合约"><a href="#在-Remix-上构建简单的水龙头合约" class="headerlink" title="在 Remix 上构建简单的水龙头合约"></a>在 Remix 上构建简单的水龙头合约</h2><p>Remix 是一个在线用于构建和部署以太坊智能合约的开发工具和平台。它提供了一个用户友好的界面和功能强大的集成开发环境（IDE），帮助开发者更轻松地编写、测试和部署智能合约。</p>
<p>Remix 集成了 Solidity 编译器，可以将 Solidity 合约代码编译成 EVM（以太坊虚拟机）字节码。开发者可以使用 Remix 提供的编译器生成合约的字节码和 ABI（应用二进制接口），以便在以太坊上部署和调用合约。</p>
<p>Remix 的地址：<a target="_blank" rel="noopener" href="https://remix.ethereum.org/">https://remix.ethereum.org</a></p>
<p><img src="/2023/04/27/27Ethereum/12.png"></p>
<h3 id="编写水龙头合约"><a href="#编写水龙头合约" class="headerlink" title="编写水龙头合约"></a>编写水龙头合约</h3><p>水龙头是一件相对简单的事情：它会向任何要求的地址发出以太。</p>
<p>在<code>contracts</code>目录下，新建一个<code>Faucet.sol</code>文件</p>
<p><img src="/2023/04/27/27Ethereum/13.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Version of Solidity compiler this program was written for</span></span><br><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"><span class="comment">// Our first contract is a faucet!</span></span><br><span class="line">contract Faucet &#123;</span><br><span class="line">    <span class="comment">// Give out ether to anyone who asks</span></span><br><span class="line">    <span class="function">function <span class="title">withdraw</span><span class="params">(uint withdraw_amount)</span> <span class="keyword">public</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Limit withdrawal amount</span></span><br><span class="line">        require(withdraw_amount &lt;= <span class="number">100000000000000000</span>);</span><br><span class="line">        <span class="comment">// Send the amount to the address that requested it</span></span><br><span class="line">        msg.sender.transfer(withdraw_amount);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Accept any incoming amount</span></span><br><span class="line">    function () <span class="keyword">public</span> payable &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>contract Faucet &#123;</code> ： 该行声明了一个合约对象，类似于其他面向对象语言中的类声明</p>
<p><code>function withdraw(uint withdraw_amount) public &#123;</code>： 该函数名为 withdraw，它接受一个名为 withdraw_amount 的无符号整数（uint）参数。它被声明为公共函数，这意味着它可以被其他合约调用</p>
<p><code>require(withdraw_amount &lt;= 100000000000000000);</code>： 该行设定提款限额。</p>
<p>使用内置的 Solidity 函数 require 来测试一个前提条件，即 withdraw_amount 小于或等于 100000000000000000 wei，这是 ether 的 基本单位，相当于 0.1 ether。</p>
<p>如果使用大于该数量的 withdraw_amount 调用 withdraw 函数，则此处的 require 函数将导致合约执行停止并因异常而失败</p>
<p><code>msg.sender.transfer(withdraw_amount);</code>： 该行是实际提现。</p>
<ul>
<li>  msg 对象：所有合约都可以访问的输入之一，它表示触发此合约执行的交易</li>
<li>  sender 属性：交易的发件人地址</li>
<li>  transfer 函数：是一个内置函数，它将以太从合约传递到调用它的地址。向后读，这意味着将以太转移到触发此合约执行的 msg 的发送者</li>
<li>  transfer 函数将金额作为其唯一参数。我们将 withdraw_amount 值作为参数传递给上面几行声明的 withdraw 函数</li>
</ul>
<p><code>function () public payable &#123;&#125;</code>： 此函数是所谓的 “回退” 或默认函数，如果触发合约的交易未命名合约中的任何已声明函数或任何函数或未包含数据，则调用此函数</p>
<h3 id="编译水龙头合约"><a href="#编译水龙头合约" class="headerlink" title="编译水龙头合约"></a>编译水龙头合约</h3><p>现在我们有了第一个示例合约，需要使用 Solidity 编译器将 Solidity 代码转换为 EVM 字节码，以便它可以由 EVM 执行。</p>
<p>在编译页面，首先要选择与代码中<code>pragma solidity ^0.4.19</code>相同的 solidity 版本。然后点击<code>Compile Faucet.sol</code>编译程序。</p>
<p><img src="/2023/04/27/27Ethereum/14.png"></p>
<h3 id="在区块链上创建合约"><a href="#在区块链上创建合约" class="headerlink" title="在区块链上创建合约"></a>在区块链上创建合约</h3><p>我们写了合约并把它编译成字节码。现在，我们需要在以太坊区块链上 “注册” 合约。我们将使用测试网来测试我们的合约。</p>
<p>在区块链上注册合约涉及创建一个特殊交易，其目的地是一个 “零地址”，也就是地址为：<code>0x0000000000000000000000000000000000000000</code>。零地址是一个特殊地址，告诉以太坊区块链我们想要注册合约。不过我们不需要手动输入这么多个 0，Remix IDE 将为我们处理所有这些，并将交易发送到 MetaMask，由钱包账户确认提交。</p>
<p>将运行环境关联到 MetaMask 上的测试链，然后点击 <code>Deploy</code>部署合约<br><img src="/2023/04/27/27Ethereum/15.png"></p>
<p>部署完成后会生成一个合约地址。同时包含了一些合约的其他信息，像合约地址的余额：<code>balance</code>，调用方法名<code>withdraw</code>等。<br><img src="/2023/04/27/27Ethereum/16.png"></p>
<h2 id="与合约交互"><a href="#与合约交互" class="headerlink" title="与合约交互"></a>与合约交互</h2><p>以太坊合约是控制资金的程序，它在称为 EVM 的虚拟机内运行。它们由特殊交易创建，该交易提交其字节码以记录在区块链上。一旦他们在区块链上创建，他们就有了一个以太坊地址，就像钱包一样。只要有人将某个交易发送到合约地址，就会导致合约在 EVM 中运行，并将该合约作为其输入。</p>
<p>发送到合约地址的交易可能包含 ether 或数据或两者。如果它们含有 ether，则将其 “存入” 合约余额。如果它们包含数据，则数据可以在合约中指定命名函数并调用它，将参数传递给函数</p>
<h3 id="资助合约"><a href="#资助合约" class="headerlink" title="资助合约"></a>资助合约</h3><p>目前，合约在其历史记录中只有一个交易：合约创建交易。</p>
<p>合约也还没有以太（零余额）。那是因为我们没有在创建交易中向合约发送任何以太。</p>
<p>我们可以给合约发一些以太，打开 MetaMask，给合约的地址发送以太，就像发送给其他任何以太坊地址一样。</p>
<p><img src="/2023/04/27/27Ethereum/17.png"></p>
<p>当交易完成后，再看合约的余额。</p>
<p><img src="/2023/04/27/27Ethereum/18.png"></p>
<h3 id="调用合约"><a href="#调用合约" class="headerlink" title="调用合约"></a>调用合约</h3><p>接下来，让我们从水龙头中提取一些资金。要提现，我们必须构造一个调用 <code>withdraw</code> 函数的交易，并将 withdraw_amount 参数传递给它。为了使事情变得简单，Remix 将为我们构建该交易，并由MetaMask发送交易。</p>
<p>我们输入要体现的金额，然后点击<code>withdraw</code>，表示调用withdraw方法。<br><img src="/2023/04/27/27Ethereum/19.png"></p>
<p>该交易导致合约在 EVM 内部运行，当 EVM 运行水龙头合约的提现功能时，首先它调用 require 函数并验证我们的金额小于或等于允许的最大提现 0.1 以太；然后它调用 transfer 函数向我们发送以太，运行转账功能会产生一个内部交易，从合约的余额中withdraw_amount的以太币存入我们的钱包地址；</p>
<p>当交易完成后，可以看到合约中的余额减少了。并且钱包中会多一条交易记录</p>
<p><img src="/2023/04/27/27Ethereum/20.png"></p>
<p><img src="/2023/04/27/27Ethereum/21.png"></p>
<p>我们可以点击<code>在区块浏览器上查看</code>，查看这条交易的详细信息。</p>
<p><img src="/2023/04/27/27Ethereum/22.png">迟到</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://yaocl.cn">Mr_Yao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yaocl.cn/2023/04/27/27Ethereum/">http://yaocl.cn/2023/04/27/27Ethereum/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yaocl.cn" target="_blank">Mr_Yao的驿站</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/web3/">web3</a><a class="post-meta__tags" href="/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/">以太坊</a></div><div class="post_share"><div class="social-share" data-image="https://yaocl.cn/2023/04/27/27Ethereum/2.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 其他发布渠道</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat_channel.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat_channel.jpg" alt="微信公众号"/></a><div class="post-qr-code-desc">微信公众号</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/05/28/29mvcc/" title="MVCC如何应对MySQL并发问题"><img class="cover" src="https://yaocl.cn/2023/05/28/29mvcc/3.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MVCC如何应对MySQL并发问题</div></div></a></div><div class="next-post pull-right"><a href="/2023/03/30/jmm/" title="从CPU聊到Java内存模型"><img class="cover" src="https://yaocl.cn/2023/03/30/jmm/9.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">从CPU聊到Java内存模型</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/06/19/18web3/" title="认识区块链和web3.0"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-19</div><div class="title">认识区块链和web3.0</div></div></a></div><div><a href="/2022/07/15/19consensus/" title="区块链的灵魂-共识机制"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-15</div><div class="title">区块链的灵魂-共识机制</div></div></a></div><div><a href="/2022/10/10/22smartContract/" title="智能合约"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-10</div><div class="title">智能合约</div></div></a></div><div><a href="/2023/01/13/25dapp/" title="什么是DAPP"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-13</div><div class="title">什么是DAPP</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Mr_Yao</div><div class="author-info__description">一只努力向上的小菜鸟</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">35</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">以太坊基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%BB%A5%E5%A4%AA%E5%9D%8A"><span class="toc-number">1.1.</span> <span class="toc-text">什么是以太坊</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%89%B9%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">以太坊特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86"><span class="toc-number">1.3.</span> <span class="toc-text">以太坊的组成部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#P2P-%E7%BD%91%E7%BB%9C"><span class="toc-number">1.3.1.</span> <span class="toc-text">P2P 网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E6%98%93%EF%BC%88Transaction%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">交易（Transaction）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%88EVM%EF%BC%89"><span class="toc-number">1.3.3.</span> <span class="toc-text">以太坊虚拟机（EVM）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88Blockchain%EF%BC%89"><span class="toc-number">1.3.4.</span> <span class="toc-text">数据库（Blockchain）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.3.5.</span> <span class="toc-text">客户端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%AD%E7%9A%84%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5"><span class="toc-number">1.4.</span> <span class="toc-text">以太坊中的重要概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A6%E6%88%B7%EF%BC%88Account%EF%BC%89"><span class="toc-number">1.4.1.</span> <span class="toc-text">账户（Account）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%EF%BC%88Address%EF%BC%89"><span class="toc-number">1.4.2.</span> <span class="toc-text">地址（Address）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E6%98%93%EF%BC%88Transaction%EF%BC%89-1"><span class="toc-number">1.4.3.</span> <span class="toc-text">交易（Transaction）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gas"><span class="toc-number">1.4.4.</span> <span class="toc-text">gas</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%9A%84%E8%B4%A7%E5%B8%81"><span class="toc-number">1.5.</span> <span class="toc-text">以太坊的货币</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%9A%84%E6%8C%96%E7%9F%BF%E4%BA%A7%E5%87%BA"><span class="toc-number">1.6.</span> <span class="toc-text">以太坊的挖矿产出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E5%9D%97%E5%A5%96%E5%8A%B1%EF%BC%88Block-rewards%EF%BC%89"><span class="toc-number">1.6.1.</span> <span class="toc-text">区块奖励（Block rewards）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%94%E5%9D%97%E5%A5%96%E5%8A%B1%EF%BC%88Uncle-rewards%EF%BC%89"><span class="toc-number">1.6.2.</span> <span class="toc-text">叔块奖励（Uncle rewards）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%94%E5%9D%97%E5%BC%95%E7%94%A8%E5%A5%96%E5%8A%B1%EF%BC%88Uncle-referencing-rewards%EF%BC%89"><span class="toc-number">1.6.3.</span> <span class="toc-text">叔块引用奖励（Uncle referencing rewards）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%8C%BA%E5%9D%97%E6%94%B6%E5%85%A5"><span class="toc-number">1.7.</span> <span class="toc-text">以太坊区块收入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%8C%BA%E5%9D%97%E6%94%B6%E5%85%A5"><span class="toc-number">1.7.1.</span> <span class="toc-text">普通区块收入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%94%E5%9D%97%E6%94%B6%E5%85%A5"><span class="toc-number">1.7.2.</span> <span class="toc-text">叔块收入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%92%8C%E5%9B%BE%E7%81%B5%E5%AE%8C%E5%A4%87"><span class="toc-number">1.8.</span> <span class="toc-text">以太坊和图灵完备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8"><span class="toc-number">1.9.</span> <span class="toc-text">去中心化应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%BA%94%E7%94%A8"><span class="toc-number">1.10.</span> <span class="toc-text">以太坊应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E5%B8%81%EF%BC%88Token%EF%BC%89"><span class="toc-number">1.11.</span> <span class="toc-text">代币（Token）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-number">1.12.</span> <span class="toc-text">名词解释</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.</span> <span class="toc-text">以太坊客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.1.</span> <span class="toc-text">什么是以太坊客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E4%BB%A5%E5%A4%AA%E5%9D%8A%E8%A7%84%E8%8C%83%E7%9A%84%E7%BD%91%E7%BB%9C"><span class="toc-number">2.2.</span> <span class="toc-text">基于以太坊规范的网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%9A%84%E5%A4%9A%E7%A7%8D%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.3.</span> <span class="toc-text">以太坊的多种客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSON-RPC"><span class="toc-number">2.4.</span> <span class="toc-text">JSON-RPC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%85%A8%E8%8A%82%E7%82%B9"><span class="toc-number">2.5.</span> <span class="toc-text">以太坊全节点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E8%BD%BB%E8%8A%82%E7%82%B9"><span class="toc-number">2.6.</span> <span class="toc-text">远程客户端和轻节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E8%8A%82%E7%82%B9%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">2.6.1.</span> <span class="toc-text">全节点的优缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E8%8A%82%E7%82%B9%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">2.6.2.</span> <span class="toc-text">公共测试网络节点的优缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E7%A7%81%E9%93%BE%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">2.6.3.</span> <span class="toc-text">本地私链的优缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8-Geth-%E6%90%AD%E5%BB%BA%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%A7%81%E9%93%BE"><span class="toc-number">2.7.</span> <span class="toc-text">用 Geth 搭建以太坊私链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E8%8A%82%E7%82%B9%E5%90%8C%E6%AD%A5"><span class="toc-number">2.7.1.</span> <span class="toc-text">启动节点同步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E7%A7%81%E9%93%BE"><span class="toc-number">2.7.2.</span> <span class="toc-text">搭建自己的私链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Geth-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%91%BD%E4%BB%A4"><span class="toc-number">2.7.3.</span> <span class="toc-text">Geth 控制台命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%BA%A4%E6%98%93"><span class="toc-number">3.</span> <span class="toc-text">以太坊交易</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%B8%81%E5%8D%95%E4%BD%8D"><span class="toc-number">3.1.</span> <span class="toc-text">以太币单位</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E8%B4%A6%E6%88%B7"><span class="toc-number">3.2.</span> <span class="toc-text">以太坊账户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%81%E9%92%A5%E3%80%81%E5%85%AC%E9%92%A5%E5%92%8C%E5%9C%B0%E5%9D%80"><span class="toc-number">3.2.1.</span> <span class="toc-text">私钥、公钥和地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E8%B4%A6%E6%88%B7%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.2.</span> <span class="toc-text">以太坊账户类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EOA"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">EOA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%88%E7%BA%A6%E8%B4%A6%E6%88%B7"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">合约账户</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E9%92%B1%E5%8C%85"><span class="toc-number">3.3.</span> <span class="toc-text">以太坊钱包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A4%E6%98%93"><span class="toc-number">3.4.</span> <span class="toc-text">交易</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nonce"><span class="toc-number">3.4.1.</span> <span class="toc-text">nonce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gas-1"><span class="toc-number">3.4.2.</span> <span class="toc-text">gas</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gas-%E7%9A%84%E8%AE%A1%E7%AE%97"><span class="toc-number">3.4.3.</span> <span class="toc-text">gas 的计算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E6%98%93%E7%9A%84%E6%8E%A5%E6%94%B6%E8%80%85%EF%BC%9Ato"><span class="toc-number">3.4.4.</span> <span class="toc-text">交易的接收者：to</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E6%98%93%E7%9A%84-value-%E5%92%8C-data"><span class="toc-number">3.4.5.</span> <span class="toc-text">交易的 value 和 data</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E4%BA%A4%E6%98%93%EF%BC%9A%E5%88%9B%E5%BB%BA%EF%BC%88%E9%83%A8%E7%BD%B2%EF%BC%89%E5%90%88%E7%BA%A6"><span class="toc-number">3.5.</span> <span class="toc-text">特殊交易：创建（部署）合约</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E8%99%9A%E6%8B%9F%E6%9C%BA-EVM"><span class="toc-number">4.</span> <span class="toc-text">以太坊虚拟机 (EVM)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E8%99%9A%E6%8B%9F%E6%9C%BA-EVM-%E7%AE%80%E4%BB%8B"><span class="toc-number">4.1.</span> <span class="toc-text">以太坊虚拟机 (EVM) 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EVM%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">4.2.</span> <span class="toc-text">EVM的工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91%E5%92%8C%E9%83%A8%E7%BD%B2"><span class="toc-number">4.2.1.</span> <span class="toc-text">代码编译和部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E6%98%93%E6%89%A7%E8%A1%8C"><span class="toc-number">4.2.2.</span> <span class="toc-text">交易执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EVM%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">4.2.3.</span> <span class="toc-text">EVM执行环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">4.2.4.</span> <span class="toc-text">执行过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6"><span class="toc-number">5.</span> <span class="toc-text">编写智能合约</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MetaMask-%E9%92%B1%E5%8C%85"><span class="toc-number">5.1.</span> <span class="toc-text">MetaMask 钱包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%B5%8B%E8%AF%95%E5%9C%B0%E5%9D%80"><span class="toc-number">5.1.1.</span> <span class="toc-text">添加测试地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%86%E5%8F%96%E6%B5%8B%E8%AF%95%E5%B8%81"><span class="toc-number">5.1.2.</span> <span class="toc-text">领取测试币</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MateMask-%E4%B8%AD%E6%B7%BB%E5%8A%A0%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E3%80%82"><span class="toc-number">5.1.3.</span> <span class="toc-text">MateMask 中添加测试网络。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8-Remix-%E4%B8%8A%E6%9E%84%E5%BB%BA%E7%AE%80%E5%8D%95%E7%9A%84%E6%B0%B4%E9%BE%99%E5%A4%B4%E5%90%88%E7%BA%A6"><span class="toc-number">5.2.</span> <span class="toc-text">在 Remix 上构建简单的水龙头合约</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%B0%B4%E9%BE%99%E5%A4%B4%E5%90%88%E7%BA%A6"><span class="toc-number">5.2.1.</span> <span class="toc-text">编写水龙头合约</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E6%B0%B4%E9%BE%99%E5%A4%B4%E5%90%88%E7%BA%A6"><span class="toc-number">5.2.2.</span> <span class="toc-text">编译水龙头合约</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%8A%E5%88%9B%E5%BB%BA%E5%90%88%E7%BA%A6"><span class="toc-number">5.2.3.</span> <span class="toc-text">在区块链上创建合约</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E5%90%88%E7%BA%A6%E4%BA%A4%E4%BA%92"><span class="toc-number">5.3.</span> <span class="toc-text">与合约交互</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E5%8A%A9%E5%90%88%E7%BA%A6"><span class="toc-number">5.3.1.</span> <span class="toc-text">资助合约</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E5%90%88%E7%BA%A6"><span class="toc-number">5.3.2.</span> <span class="toc-text">调用合约</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/14/33Oracles/" title="区块链预言机：智能合约与现实世界的桥梁">区块链预言机：智能合约与现实世界的桥梁</a><time datetime="2025-01-14T07:39:19.000Z" title="发表于 2025-01-14 15:39:19">2025-01-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/05/32Solana/" title="Solana：重塑区块链生态的高速革命">Solana：重塑区块链生态的高速革命</a><time datetime="2025-01-05T07:22:18.000Z" title="发表于 2025-01-05 15:22:18">2025-01-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/06/31innodb/" title="InnoDB 存储引擎是如何管理和存储数据">InnoDB 存储引擎是如何管理和存储数据</a><time datetime="2023-08-06T08:41:39.000Z" title="发表于 2023-08-06 16:41:39">2023-08-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/26/28zerocopy/" title="搞明白什么是零拷贝，就是这么简单">搞明白什么是零拷贝，就是这么简单</a><time datetime="2023-07-26T14:09:23.000Z" title="发表于 2023-07-26 22:09:23">2023-07-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/06/30layer2/" title="跨越性能瓶颈：Layer2技术为区块链解决可扩展性问题">跨越性能瓶颈：Layer2技术为区块链解决可扩展性问题</a><time datetime="2023-06-06T08:37:29.000Z" title="发表于 2023-06-06 16:37:29">2023-06-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Mr_Yao</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadUtterances () {
  let ele = document.createElement('script')
  ele.setAttribute('id', 'utterances_comment')
  ele.setAttribute('src', 'https://utteranc.es/client.js')
  ele.setAttribute('repo', 'yaocl0/blogtalk')
  ele.setAttribute('issue-term', 'pathname')
  let nowTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'photon-dark' : 'github-light'
  ele.setAttribute('theme', nowTheme)
  ele.setAttribute('crossorigin', 'anonymous')
  ele.setAttribute('async', 'true')
  document.getElementById('utterances-wrap').insertAdjacentElement('afterbegin',ele)
}

function utterancesTheme (theme) {
  const iframe = document.querySelector('.utterances-frame')
  if (iframe) {
    const theme = theme === 'dark' ? 'photon-dark' : 'github-light'
    const message = {
      type: 'set-theme',
      theme: theme
    };
    iframe.contentWindow.postMessage(message, 'https://utteranc.es');
  }
}

btf.addModeChange('utterances', utterancesTheme)

if ('Utterances' === 'Utterances' || !false) {
  if (false) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
  else loadUtterances()
} else {
  function loadOtherComment () {
    loadUtterances()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>